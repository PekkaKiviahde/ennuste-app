MVP-työnkulut
WF1: Mappingin määrittely (työlitterat → tavoitearvio-littera)

Tavoite: pystyä yhdistämään usean työlitteran ostot/toteumat yhden tavoitearvio-litteran alle taloudellista suunnittelua varten.

Käyttäjä valitsee tavoitearvio-litteran

Käyttäjä lisää työlitterat + säännön:

FULL (100%) tai

PERCENT (esim. 30/70)

Mapping tallennetaan versiona (valid_from/to)

Järjestelmä laskee “toteuma tavoitelitteralle” = Σ(työlittera toteuma × allokointi)

Hyväksymissääntö (MVP):

Jos PERCENT, summan pitää olla 100% (± pieni toleranssi)

Muutokset mappingiin kirjataan lokiin (kuka/milloin/miksi)

WF2: Työn taloudellinen suunnittelu (ennen ennustetta)

Käyttäjä avaa tavoitearvio-litteran

Näkee:

tavoite (BudgetLine)

toteuma (ActualCostLine mappingin kautta)

viimeisimmän ennusteen (ForecastCurrentView)

Kirjaa PlanningNote:

miten työ johdetaan

huomiot

riskit

päätökset

Asettaa tilaksi READY_FOR_FORECAST

Hyväksymissääntö (MVP):

Ennusteen tekeminen sallitaan vain, jos suunnitelma on READY_FOR_FORECAST tai LOCKED

WF3: Ennustetapahtuma (append-only)

Käyttäjä avaa tavoitearvio-litteran (jolla on suunnitelma)

Syöttää kustannuslajikohtaiset ennusteet (5 kpl)

Kirjaa perustelut:

memo_general / memo_procurement / memo_calculation

(optional) Lisää rivimuistiot (ForecastRowMemo)

(optional) Tallentaa laskentapaneelin snapshotin

Paina “Tallenna ennuste” → syntyy:

1 kpl ForecastEvent

5 kpl ForecastEventLine (tai vähemmän jos sallitaan tyhjät)

0..n kpl RowMemo

0..1 kpl CalcPanelSnapshot

Hyväksymissääntö (MVP):

Tapahtumaa ei voi muokata jälkeenpäin, vain tehdä uusi tapahtuma (korjaus = uusi event)

Pakolliset kentät:

target_littera

vähintään 1 cost_type forecast_value (tai kaikki 5 — päätetään)

comment tai memo_general (pakollinen perustelu)

WF4: Raportointi (ryhmä 0–9)

Järjestelmä muodostaa GroupSummaryView:

sum(tavoite), sum(toteuma), sum(ennuste)

taloudellinen valmiusaste (toteuma / ennuste tai oma kaava)

tekninen valmiusaste (syötetty tai laskettu)

Näytä:

tavoitearviolitteroittain

työlitteroittain (drill down)

“Miksi muuttui?” -näkymä:

listaa ForecastEventit aikajärjestyksessä ja näyttää perustelut