erDiagram
  ORGANIZATIONS ||--o{ PROJECTS : owns
  TENANTS ||--o{ PROJECTS : owns
  USERS ||--o{ ORGANIZATION_MEMBERSHIPS : has
  ORGANIZATIONS ||--o{ ORGANIZATION_MEMBERSHIPS : includes
  USERS ||--o{ ORGANIZATION_ROLE_ASSIGNMENTS : assigned
  ORGANIZATIONS ||--o{ ORGANIZATION_ROLE_ASSIGNMENTS : scopes
  USERS ||--o{ PROJECT_ROLE_ASSIGNMENTS : assigned
  PROJECTS ||--o{ PROJECT_ROLE_ASSIGNMENTS : scopes
  ROLES ||--o{ ROLE_PERMISSIONS : grants
  PERMISSIONS ||--o{ ROLE_PERMISSIONS : includes

  PROJECTS ||--o{ LITTERAS : has
  PROJECTS ||--o{ PLANNING_EVENTS : logs
  PROJECTS ||--o{ FORECAST_EVENTS : logs
  FORECAST_EVENTS ||--o{ FORECAST_EVENT_LINES : has

  PROJECTS ||--o{ MAPPING_VERSIONS : has
  MAPPING_VERSIONS ||--o{ ROW_MAPPINGS : includes
  MAPPING_VERSIONS ||--o{ V_CURRENT_ITEM_MAPPINGS : current
  BUDGET_ITEMS ||--o{ ROW_MAPPINGS : item
  BUDGET_ITEMS ||--o{ V_CURRENT_ITEM_MAPPINGS : item
  WORK_PHASES ||--o{ ROW_MAPPINGS : work_package
  WORK_PHASES ||--o{ V_CURRENT_ITEM_MAPPINGS : work_package
  PROC_PACKAGES ||--o{ ROW_MAPPINGS : procurement
  PROC_PACKAGES ||--o{ V_CURRENT_ITEM_MAPPINGS : procurement
  WORK_PHASES ||--o{ PROC_PACKAGES : default_work_package
  TARGET_ESTIMATE_ITEM_MAPPINGS ||--o{ ROW_MAPPINGS : LEGACY/DEPRECATED

  PROJECTS ||--o{ IMPORT_BATCHES : has
  IMPORT_BATCHES ||--o{ BUDGET_LINES : loads
  IMPORT_BATCHES ||--o{ BUDGET_ITEMS : loads
  PROJECTS ||--o{ ACTUAL_COST_LINES : has

  PROJECTS ||--o{ WORK_PHASES : has
  WORK_PHASES ||--o{ WORK_PHASE_VERSIONS : versions
  WORK_PHASE_VERSIONS ||--o{ WORK_PHASE_MEMBERS : members
  WORK_PHASES ||--o{ WORK_PHASE_BASELINES : baselines
  WORK_PHASE_BASELINES ||--o{ WORK_PHASE_BASELINE_LINES : lines
  WORK_PHASES ||--o{ WORK_PHASE_WEEKLY_UPDATES : updates
  WORK_PHASES ||--o{ GHOST_COST_ENTRIES : ghosts
  GHOST_COST_ENTRIES ||--o{ GHOST_COST_SETTLEMENTS : settles
  WORK_PHASES ||--o{ WORK_PHASE_CHANGE_EVENTS : changes
  WORK_PHASE_CHANGE_EVENTS ||--o{ WORK_PHASE_CHANGE_APPROVALS : approvals
  WORK_PHASES ||--o{ WORK_PHASE_CORRECTIONS : corrections

  PROJECTS ||--o{ APP_AUDIT_LOG : audits
  PROJECTS ||--o{ ATTACHMENTS : attachments

  ORGANIZATIONS {
    uuid organization_id PK
    text slug
  }
  TENANTS {
    uuid tenant_id PK
    text name
  }
  PROJECTS {
    uuid project_id PK
    uuid organization_id FK
    uuid tenant_id FK
    text name
  }
  USERS {
    uuid user_id PK
    text username
  }
  LITTERAS {
    uuid littera_id PK
    uuid project_id FK
    text code
  }
  PLANNING_EVENTS {
    uuid planning_event_id PK
    uuid project_id FK
    uuid target_littera_id FK
  }
  FORECAST_EVENTS {
    uuid forecast_event_id PK
    uuid project_id FK
    uuid target_littera_id FK
  }
  FORECAST_EVENT_LINES {
    uuid forecast_event_line_id PK
    uuid forecast_event_id FK
  }
  MAPPING_VERSIONS {
    uuid mapping_version_id PK
    uuid project_id FK
    text mapping_kind
    text status
    uuid import_batch_id FK
  }
  ROW_MAPPINGS {
    uuid row_mapping_id PK
    uuid mapping_version_id FK
    uuid budget_item_id FK
    uuid work_phase_id FK
    uuid proc_package_id FK
    timestamptz created_at
  }
  V_CURRENT_ITEM_MAPPINGS {
    uuid row_mapping_id PK
    uuid mapping_version_id FK
    uuid budget_item_id FK
    uuid work_phase_id FK
    uuid proc_package_id FK
  }
  TARGET_ESTIMATE_ITEM_MAPPINGS {
    uuid target_estimate_item_mapping_id PK
    uuid project_id FK
    uuid budget_item_id FK
    uuid work_phase_id FK
    uuid proc_package_id FK
  }
  IMPORT_BATCHES {
    uuid import_batch_id PK
    uuid project_id FK
  }
  BUDGET_LINES {
    uuid budget_line_id PK
    uuid project_id FK
    uuid target_littera_id FK
  }
  BUDGET_ITEMS {
    uuid budget_item_id PK
    uuid project_id FK
  }
  ACTUAL_COST_LINES {
    uuid actual_cost_line_id PK
    uuid project_id FK
    uuid work_littera_id FK
  }
  WORK_PHASES {
    uuid work_phase_id PK
    uuid project_id FK
  }
  PROC_PACKAGES {
    uuid proc_package_id PK
    uuid project_id FK
    uuid default_work_package_id FK
  }
  WORK_PHASE_VERSIONS {
    uuid work_phase_version_id PK
    uuid work_phase_id FK
  }
  WORK_PHASE_MEMBERS {
    uuid work_phase_member_id PK
    uuid work_phase_version_id FK
  }
  WORK_PHASE_BASELINES {
    uuid work_phase_baseline_id PK
    uuid work_phase_id FK
  }
  WORK_PHASE_BASELINE_LINES {
    uuid work_phase_baseline_id FK
  }
  APP_AUDIT_LOG {
    uuid audit_event_id PK
    uuid project_id FK
  }
  ATTACHMENTS {
    uuid attachment_id PK
    uuid owner_id
  }
  NOTE_APPEND_ONLY {
    text "Write = INSERT row_mappings (append-only)"
    text "Read = v_current_item_mappings"
  }
